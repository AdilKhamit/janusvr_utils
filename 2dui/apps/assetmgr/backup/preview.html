<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>Asset Previewer</title>
    <meta name="description" content="JanusVR Interface Settings Menu">
    <meta name="author" content="JanusVR Inc.">
    <script src="../../../scripts/tabs.js"></script>
    <script src="lib/jquery-3.0.0.min.js"></script>
    <script src="lib/jquery.form.min.js"></script>

    <link rel="stylesheet" type="text/css" href="../../../skins/emerald/emeraldgenericwindow.css">

    <style>
      html, body {
        width: 100%;
        height: 100%;
        margin: 0px;
      }

      .windowarea, .windowcontainer, img {
        width: 100%;
        height: 100%;
        background: white;
      }

      iframe {
        width: 100%;
        height: 100%;
        border: 0px;
      }

    </style>
    <script type='text/javascript'>
      var listeners = [];
      window.onMessage = function(cb) {
        listeners.push(cb);
      }

      window.addEventListener('message', function(ev) {
        var id = ev.data.id;

        if (!frameIDs[id])
          return;

        frameIDs[id](ev.data.content);
        $('#' + id).remove();
        delete frameIDs[id];
      }, false);

      var frameIDs = [];

      function loadViaFrame(url, cb) {
        var id = 'f' + Math.floor(Math.random() * 100000000);
        if (url.search(/\?/) == -1) {
          url += '?iframe=' + id;
        } else {
          url += '&iframe=' + id;
        }

        frameIDs[id] = cb;

        var frame = $('<iframe/>');
        frame.attr('src', url);
        frame.attr('id', id);
        frame.appendTo('body');
      }

      function include(src) {
        src += '?r=' + Math.random();
        var s = document.createElement('script');
        s.src = src;

        document.head.appendChild(s);

        return s;
      }

      var params = {};
      var baseurl = 'http://strandedin.space:8081/';
      var assetURL;

      $(document).ready(function() {
        function displayError(error) {
          error = error || 'Error';
          $('.windowarea').html('<h1>' + error + '</h1>')
        }
        var query = location.href.split('?').pop();

        if (!query)
          return displayError('No query data');


        var toks = query.split('&');
        for (var i in toks) {
          var pair = toks[i].split('=');

          var val = pair.pop();
          var key = pair.pop();

          params[key] = val;
        }

        var type = params['filetype'];

        if (!type)
          return displayError('Missing filetype');

        assetURL = baseurl + 'asset/get/' + params['uuid'];
        include('previewers/' + type + '.js');
      });
    </script>

  </head>
  <body>
    <div class="windowcontainer">
      <div class="windowarea unselectable" id="windowarea">

      </div>
    </div>
  </body>
</html>
